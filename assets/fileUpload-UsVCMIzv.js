import{d as K,z as W,j as F,a as r,w as q,b as L,n as Q,o as b,i as X,m as h,h as J,e as p,g as c,p as w,u as N,J as S,R as C,c as D,t as y,l as Y,E as Z,f as ee,_ as te}from"./index-B1Bxyaam.js";import le from"./commonShowForm-n-iAP6yz.js";import{c as ae}from"./baseComponents-RnJWui-k.js";/* empty css                                                                            *//* empty css                                                                                  *//* empty css                                                                     *//* empty css                                                                         */import"./mockApi-Dv8g5J8g.js";import"./common-6_N1m61o.js";/* empty css                                                                     *//* empty css                                                                   */import oe from"./commonDialog-BXUS_tV4.js";import ie from"./upload-DRrpnidx.js";/* empty css                                                                                       *//* empty css                                                                      *//* empty css                                                                       *//* empty css                                                                        *//* empty css                                                              *//* empty css                                                                 *//* empty css                                                                 *//* empty css                                                                   *//* empty css                                                                 *//* empty css                                                                             *//* empty css                                                              *//* empty css                                                             *//* empty css                                                               *//* empty css                                                                  *//* empty css                                                                    *//* empty css                                                                    *//* empty css                                                          *//* empty css                                                                   *//* empty css                                                                       *//* empty css                                                                    */import se from"./lowCodeTable-DcCxoWs6.js";import"./lowCodeStore-DxJieuWc.js";/* empty css                                                                       *//* empty css                                                                     *//* empty css                                                               */import"./commonButton-BvmCciLN.js";import"./commonStore-BXOqXE7T.js";/* empty css                                                                     */const ue={class:"templateSet-fileUpload"},ne={class:"templateSet-fileUpload-usePanel"},re={key:0},de={key:1},me={key:0},pe=["src"],ce=K({__name:"fileUpload",props:{componentsData:{type:Object},detail:{type:Boolean},allowButtons:{type:Array,default:[]},multiple:Boolean,selfHeight:{type:String,default:"295px"},disabled:{type:Boolean,default:!1}},setup(a,{expose:O}){W();const x=F("$defultRequest"),T=F("$Base64"),t=a,V=r(null),e=r([]),B=r(!1),g=r({}),u=r({title:"提示",tip:!1,fileSrc:""}),U=r(""),d=r(""),k=r(),s=r({templateValue:[]}),m=r(!1),_=l=>{t.componentsData.multiple==!0||s.value.templateValue.length==0?(s.value.templateValue.push(l.data),t.componentsData.isRequired===!0&&f()):(u.value.title="提示",u.value.tip=!0,d.value="文件覆盖",k.value=JSON.parse(JSON.stringify(l.data)),G())},A=()=>{if(e.value.length>0){u.value.title="提示",u.value.tip=!0,d.value="删除";let l="";e.value.forEach((o,i)=>{i+1<e.value.length?l+=o.originalName+",":l+=o.originalName})}},E=()=>{if(e.value.length>0){let l=[];e.value.forEach(o=>{l.push(o.id)}),x.request({url:S.fileApi.batchDelete,method:"put",data:l}).then(o=>{for(let i=0;i<e.value.length;i++)for(let v=0;v<s.value.templateValue.length;v++)e.value[i].id===s.value.templateValue[v].id&&(s.value.templateValue.splice(v,1),v--);t.componentsData.isRequired===!0&&f(),e.value=[]}).catch(o=>{t.componentsData.isRequired===!0&&f(),e.value=[]})}},I=()=>{const l="";if(e.value.length>0){let o="";e.value.forEach(i=>{o+=i.id+","}),window.open(l+"/hf-fileupload/api/v1/files/download?ids="+o,"_self"),e.value=[]}},j=()=>{e.value.length===1&&(localStorage.removeItem("fileViewData"),u.value.title="附件预览",u.value.tip=!1,u.value.fileSrc=e.value[0].url,window.open(""+encodeURIComponent(T.encode(""+S.fileApi.viewFile+"?id="+e.value[0].id+"&fullfilename="+e.value[0].name))),d.value="预览")},z=()=>{e.value.length===1&&(e.value[0].rename=!0,e.value[0].tempName=JSON.parse(JSON.stringify(e.value[0].originalName)))},P=()=>{e.value[0].rename=!1,x.request({url:S.fileApi.update,method:"post",data:{...e.value[0],originalName:e.value[0].tempName}}).then(l=>{e.value[0].originalName=JSON.parse(JSON.stringify(e.value[0].tempName)),t.componentsData.isRequired===!0&&f()}).catch(l=>{e.value[0].tempName=JSON.parse(JSON.stringify(e.value[0].originalName)),t.componentsData.isRequired===!0&&f()})},G=()=>{(e.value.length>0||d.value=="文件覆盖")&&g.value.dialogController()},H=()=>{d.value=="删除"&&E(),d.value=="预览"&&g.value.dialogController(),d.value=="文件覆盖"&&(s.value.templateValue=[],s.value.templateValue.push(k.value),t.componentsData.isRequired===!0&&f(),g.value.dialogController())},M=()=>({}),f=async()=>ae(V);O({check:f,formData:s});const $=()=>{t.disabled==!0?U.value="selectionDisabled":U.value=""};return q(()=>t.allowButtons,l=>{t.allowButtons.includes("upload")?m.value=!0:m.value=!1},{immediate:!0}),L(()=>{$(),Q(()=>{t.detail==!0?(t.allowButtons.includes("upload")?m.value=!0:m.value=!1,t.allowButtons.splice(0,t.allowButtons.length),t.allowButtons.push("preview")):(t.allowButtons.length>0&&!t.allowButtons.includes("preview")||(t.allowButtons.splice(0,t.allowButtons.length),t.allowButtons.push("preview"),t.allowButtons.push("upload"),t.allowButtons.push("download"),t.allowButtons.push("delete"),t.allowButtons.push("rename")),t.allowButtons.includes("upload")?m.value=!0:m.value=!1)})}),q(()=>e,l=>{l.value.length>1?B.value=!0:B.value=!1},{deep:!0,immediate:!0}),(l,o)=>{const i=J("el-table-column"),v=J("el-input");return b(),X(le,{ref_key:"commonShowForm",ref:V,"form-data":s.value,"form-rules":M(),"parent-data":t.componentsData,detail:a.detail},{default:h(()=>[p("div",ue,[p("div",ne,[c(N(ie),{customFunc:_,url:N(S).userCentereApi.updateUserAvatar,multiple:a.componentsData.multiple,imageType:!0,accept:"application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/msword,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/vnd.ms-excel,.jpg, .png, .JPG, .PNG, .jpeg, .JPEG",class:w([a.allowButtons.includes("upload")?"":"disabledUseButton",a.disabled==!0?"disabledUseButton":""])},{default:h(()=>[p("div",{class:w(["useButton",m.value==!0?"":"disabledUseButton"])},"上传文件",2)]),_:1},8,["url","multiple","class"]),p("div",{class:w(["useButton",a.allowButtons.includes("download")?"":"disabledUseButton",a.disabled?"disabledUseButton":""]),onClick:C(I,["stop"])}," 下载 ",2),p("div",{class:w(["useButton",a.allowButtons.includes("delete")?"":"disabledUseButton",a.disabled?"disabledUseButton":""]),onClick:C(A,["stop"])}," 删除 ",2),p("div",{class:w(["useButton",B.value==!0?"disabledUseButton":"",a.allowButtons.includes("preview")?"":"disabledUseButton",a.disabled?"disabledUseButton":""]),onClick:C(j,["stop"])}," 预览 ",2),p("div",{class:w(["useButton",B.value==!0?"disabledUseButton":"",a.allowButtons.includes("rename")?"":"disabledUseButton",a.disabled?"disabledUseButton":""]),onClick:C(z,["stop"])}," 重命名 ",2)]),c(N(se),{data:s.value.templateValue,border:"","max-height":a.selfHeight,onSelect:o[0]||(o[0]=(n,R)=>{e.value=n}),onSelectAll:o[1]||(o[1]=n=>{e.value=n})},{default:h(()=>[c(i,{type:"selection","class-name":U.value},null,8,["class-name"]),c(i,{label:"序号",type:"index",width:"65px"}),c(i,{label:"文件名"},{default:h(n=>[n.row.rename==!0?(b(),D("div",re,[c(v,{modelValue:n.row.tempName,"onUpdate:modelValue":R=>n.row.tempName=R,placeholder:"请输入",maxlength:"100",onBlur:P},null,8,["modelValue","onUpdate:modelValue"])])):(b(),D("div",de,y(n.row.originalName),1))]),_:1}),c(i,{label:"文件类型",prop:"suffix"}),c(i,{label:"文件大小",prop:"size"},{default:h(n=>[p("div",null,y(n.row.size+"KB"),1)]),_:1})]),_:1},8,["data","max-height"])]),c(N(oe),{title:u.value.title,tip:u.value.tip,ref_key:"commonDialog",ref:g,onConfirm:H,"confirm-name":"确定"},Y({default:h(()=>[d.value=="预览"?(b(),D("div",me,[p("iframe",{src:u.value.fileSrc,class:"inner-iframe"},null,8,pe)])):ee("",!0)]),_:2},[d.value=="文件覆盖"?{name:"tip",fn:h(()=>[Z(y("新上传的文件将替换已有文件"))]),key:"0"}:void 0]),1032,["title","tip"])]),_:1},8,["form-data","form-rules","parent-data","detail"])}}}),tt=te(ce,[["__scopeId","data-v-b1f02589"]]);export{tt as default};
